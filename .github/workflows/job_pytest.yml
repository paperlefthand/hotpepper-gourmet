name: pytest

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - develop

jobs:
  pytest:
    name: Run tests with pytest
    runs-on: ubuntu-latest
    steps:
        - name: Checkout
          uses: actions/checkout@v2
        - name: Install Poetry
          run: |
            curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python
        - name: Add path for Poetry
          run: echo "$HOME/.poetry/bin" >> $GITHUB_PATH
        - name: Install Dependencies
          run: poetry install --no-interaction          
        - name: Run Tests
          env: 
            KEYID: ${{ secrets.KEYID }}
          run: poetry run pytest -v 